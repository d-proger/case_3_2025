# Проект: Платформа для публикации постов

## Описание проекта
Данный проект представляет собой простую веб-платформу для публикации и просмотра постов. Он включает в себя систему регистрации и авторизации пользователей, возможность создания постов, их просмотр с пагинацией и фильтрацией по тегам, а также функционал запроса доступа к контенту.

## Основные возможности:
*   **Регистрация и авторизация пользователей:** Пользователи могут создавать учетные записи, входить в систему и управлять своими профилями. Пароли хранятся в хешированном виде.
*   **Просмотр постов:** Главная страница отображает все посты с пагинацией.
*   **Фильтрация по тегам:** Возможность фильтрации постов по определенным тегам.
*   **Создание постов:** Зарегистрированные пользователи могут добавлять новые посты.
*   **Система запроса доступа:** Некоторые посты могут быть доступны только по запросу, который должен быть одобрен.
*   **Профили пользователей:** Просмотр профилей авторов постов.

## Установка и запуск:

1.  **Клонируйте репозиторий:**
    ```bash
    git clone <URL_ВАШЕГО_РЕПОЗИТОРИЯ>
    cd case_3
    ```
2.  **Настройка базы данных:**
    *   Создайте базу данных MySQL с именем `case_3`.
    *   Импортируйте необходимую структуру таблиц и тестовые данные (если есть). Примерные таблицы: `users`, `posts`, `tags`, `post_tags`, `on_requests`.
    *   Обновите данные для подключения к базе данных в файле `vendor/connect.php`:
        ```php
        $dsn = "mysql:host=127.127.126.50;dbname=case_3;charset=utf8mb4"; // Укажите ваш хост и имя БД
        $user = "root"; // Ваш пользователь БД
        $pass = ""; // Ваш пароль БД
        ```
3.  **Размещение файлов:**
    *   Разместите все файлы проекта на вашем веб-сервере (например, Apache или Nginx), настроенном для обработки PHP.
    *   Убедитесь, что директория `uploads/` имеет права на запись для веб-сервера, так как туда будут загружаться аватары и изображения постов.
4.  **Запуск:**
    *   Откройте проект в браузере, перейдя по адресу вашего сервера (например, `http://localhost/`).

---

## Отчет по выполненной задаче

### 1. Подробный анализ по выполненной задаче (не менее 7 пунктов):

*   **1.1. Архитектура и структура проекта:** Проект организован с четким разделением на основные функциональные области: пользовательские страницы (например, `index.php`, `profile.php`), вспомогательные PHP-файлы для логики (`vendor/`), статические ресурсы (`assets/`) и переиспользуемые шаблоны (`templates/`). Такая модульная структура облегчает навигацию, поддержку и потенциальное масштабирование. Например, `header.php` и `footer.php` используются на большинстве страниц для единообразного отображения.
*   **1.2. Работа с базой данных через PDO:** Взаимодействие с базой данных реализовано с использованием PDO (PHP Data Objects), что является стандартом безопасности. Подготовленные запросы (`$pdo->prepare()`, `$stmt->execute()`) эффективно предотвращают SQL-инъекции, поскольку пользовательские данные передаются отдельно от SQL-запроса, исключая возможность внедрения вредоносного кода. Файл `vendor/connect.php` централизует подключение к БД.
*   **1.3. Надежная аутентификация и хеширование паролей:** Система аутентификации использует современные и безопасные методы. Пароли пользователей не хранятся в открытом виде, а хешируются с помощью функции `password_hash()`, что делает их практически невосстановимыми. При проверке пароля используется `password_verify()`, который безопасно сравнивает введенный пароль с хешем из базы данных, обеспечивая высокий уровень безопасности данных пользователей.
*   **1.4. Использование безопасных HTTP-куки для сессий:** Для управления пользовательскими сессиями (`user_id`) используются HTTP-куки с важными атрибутами безопасности: `secure` (передача только по HTTPS), `httponly` (недоступны для JavaScript, что предотвращает XSS-атаки) и `samesite=Strict` (защита от CSRF-атак, ограничивая отправку куки только с запросами одного и того же сайта). Это значительно повышает защиту от перехвата сессий и нежелательных действий.
*   **1.5. Базовая валидация данных при регистрации:** Процесс регистрации включает базовые, но важные проверки: сравнение введенных паролей (`$password !== $password_confirm`) и проверку на уникальность email (`SELECT COUNT(*) FROM users WHERE email = :email`). Это помогает предотвратить создание некорректных или дублирующихся учетных записей.
*   **1.6. Корректная обработка загрузки файлов:** При загрузке аватаров (`vendor/signup.php`) используются функции `move_uploaded_file()` для безопасного перемещения файла и `time() . basename($_FILES['avatar']['name'])` для генерации уникального имени файла. Это предотвращает конфликты имен и потенциальную перезапись файлов. Также предусмотрен путь для аватара по умолчанию, если файл не загружен.
*   **1.7. Система сообщений на основе сессий:** Для уведомления пользователя об ошибках (например, при некорректной авторизации или регистрации) используется механизм сессионных сообщений (`$_SESSION['message']`). Сообщения отображаются один раз и автоматически очищаются после показа, что обеспечивает чистоту интерфейса и актуальность информации.

### 2. Рекомендации по устранению выявленных ошибок (потенциальные улучшения) в ходе выполнения задачи:

*   **2.1. Улучшенная валидация и санитаризация пользовательского ввода:** Хотя PDO предотвращает SQL-инъекции, все входящие пользовательские данные (`$_GET`, `$_POST`, `$_COOKIE`) должны быть санитаризированы и валидированы. Например, для вывода данных в HTML следует всегда использовать `htmlspecialchars()` или аналогичные функции для предотвращения XSS-атак, даже если данные не сохраняются в БД.
*   **2.2. Централизованная обработка ошибок и логирование:** В текущей реализации ошибки базы данных могут быть выведены напрямую пользователю (`echo 'Ошибка базы данных: ' . $e->getMessage();`). В рабочей среде это небезопасно, так как может раскрыть чувствительную информацию о структуре БД. Рекомендуется настроить логирование ошибок на сервере (например, в файл журнала) и отображать пользователю только общее, неинформативное сообщение об ошибке.
*   **2.3. Дополнительные проверки при загрузке файлов:** Текущая обработка загрузки файлов является базовой. Рекомендуется добавить проверку MIME-типа файла (не только расширения) для предотвращения загрузки исполняемых файлов, а также ограничить максимальный размер файла. Важно настроить веб-сервер так, чтобы он никогда не исполнял PHP-код из директории `uploads/`, обрабатывая её только как статический контент.
*   **2.4. Внедрение CSRF-токенов для всех форм:** Несмотря на атрибут `samesite=Strict` для куки, для всех форм, которые изменяют состояние на сервере (регистрация, вход, добавление поста), рекомендуется использовать явные CSRF-токены. Это обеспечит дополнительный уровень защиты от межсайтовой подделки запросов.
*   **2.5. Разделение логики и представления (MVC-принципы):** В некоторых файлах (например, `index.php`) логика PHP и HTML-разметка тесно переплетены. Для более крупных и сложных проектов рекомендуется применять принципы MVC (Model-View-Controller) или использовать шаблонизаторы (например, Twig, Blade). Это улучшит читаемость кода, упростит его поддержку и позволит разработчикам сосредоточиться на своей части работы.
*   **2.6. Ограничение попыток авторизации:** Для предотвращения атак методом подбора (brute-force) на форму авторизации рекомендуется реализовать механизм ограничения количества неудачных попыток входа (например, через блокировку IP-адреса на короткий период или увеличение задержки между попытками).
*   **2.7. Оптимизация запросов к базе данных:** В `index.php` для каждого поста, если доступ не одобрен, выполняется отдельный запрос к базе данных (`SELECT request_status FROM on_requests WHERE user_id = :user_id AND post_id = :post_id`). Это может привести к "проблеме N+1 запроса" (N запросов в цикле). Для оптимизации можно загружать статусы запросов для всех отображаемых постов одним запросом. 